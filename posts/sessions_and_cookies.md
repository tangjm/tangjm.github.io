--- 
title: 'Learning about sessions and cookies with Express and express-session'
date: '2023-07-15' 
---

### Sessions and cookies in Express

A session is initially created by the server when the client makes its very first contact. It is a data object that serves to track the website activity of a client through time and is usually persisted to a data store. It will also have a unique identifier to distinguish the session from other sessions that may exist in the data store. This identifier, which is by default named 'connect.sid' by the ‘express-session’ library, is what gets sent from the server back to the client as part of the 'Set-Cookie' HTTP response header to instruct the client to include a 'Cookie’ HTTP request header for each request from that point onwards with the session identifier key-value pair as its value. This header will look something like `Cookie: connect.sid=s%3ARGvE`. Cookies are a form of storage in the browser and can be used to store data found in the ‘Set-Cookie’ HTTP response header received from the server. 

If a client has previously made requests to a server and now makes another request, it will have a 'Cookie' header containing any cookies, including the session identifier in our case. When the server receives such a request, it will check that the request is valid by performing a range of checks. This might include checking that it has the same signature as the one that the server created to ensure the client has not modified the session identifier, checking that it has associated session data in the session data store, and that the session has not expired. Once these checks are complete, ‘express-session’ will fetch the session data from the data store and make it available on the request object at ‘req.session’. It then passes control to express which should pass the request and response objects to the next layer of middleware. These layers of middleware may proceed to do different things such as fetching data from databases, contacting other services like email verification services, sending data back to the client, and handling errors. Eventually, some middleware will complete its actions and send back a HTTP response to the client, which terminates the request-response interaction potentially skipping any further layers of middleware not yet encountered.

Sessions provide a way for the server to associate HTTP requests with a single client whilst also treating each request as isolated from any other requests. By treating each request as independent, it means that, for all the server knows, there could be a single client, or any number of clients that are issuing requests. It is also unable to figure out how the mapping looks between clients and requests working backwards from the requests. It cannot determine which requests belong to which clients. This makes it impossible for a server to gain deeper insight into the way clients interact with it over time by just analysing the requests it receives.

The session is what provides the server with some idea of how to group requests together. Unlike requests, which are singular events that happen at a particular point in time and have no extension through time, sessions have extension through time and are a series of requests that occur over time. Once the server is able to group requests through the abstraction that sessions provide, it can then analyse the interactions that a session makes with the server over time treating each session as if it was a different client. Then the server just needs to make the final link to associate sessions with clients to figure out the behaviour of a client. This last step is needed because a client may have multiple sessions depending on whether their browser cookies were cleared or if their session expired.

With this in mind, the session identifier can serve the purpose of uniting a series of what would otherwise be unrelated requests over time and identify them to the server as originating from a single client. By identifying a session with a client, the server is then able to track the behaviour and interactions of a client over time via tracking the requests associated with a given session. This is how the use of sessions addresses the problem of how to track the activity of clients over time whilst also respecting the stateless client-server interaction specified by the principles of REST architecture. 

