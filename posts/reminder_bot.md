--- 
title: 'Reminder bot' 
date: '2023-03-04' 
--- 

Today I finally deployed my discord bot that sends reminders at fixed intervals specified using cron syntax. This has been a long-running project that I have been working on intermittently over the past couple of months. 

The first bot I wrote used the discord.js library which was a wrapper over the Discord API. This bot contained several features that correspond to CRUD operations for creating, displaying, updating, and deleting scheduled reminders. I managed to also design the application so that reminders were guild-specific - the reminders created by users would ping the corresponding guild channel that they belonged to and each guild could invite the bot and have their own instances of the same or different reminders. I tried hosting this on free servers like Heroku, Replit but the issue I faced was that it relied on a server that was constantly running with zero downtime. Most of these free hosting providers for backend applications automatically shutdown after a specified period of inactivity making them unsuitable for my purposes as I need my discord bot to send reminders reliably at exactly the times they were scheduled.

An approach I didn't take but could have taken is to run my own AWS EC2 instance. I didn't take this approach mainly because I just wanted something simple that would help automate some mundane task.

Not long afterwards I discovered Cloudflare Workers which provided an alternative platform for hosting serverless apps. The idea was to port the basic functionality of my current app to Cloudflare. This move was more gnarly than what I first expected. An intial problem was to find a serverless alternative to 'node-cron', the library I was using to manage code that would be executed on a schedule, as this task manager requires a server to run. It turned out that Cloudflare has its equivalent, the cron trigger, which is a cron-like utility baked into Cloudflare serverless applications that executes a serverless function at scheduled times according to cron syntax. The next step was to figure out how to get my discord bot to proactively send a message to a guild channel using discord.js when the scheduled function runs. I initially concluded that this wasn't possible because just like what is documented in the discord.js guide, the discord bot first needs to login and then listen for responses which implied that it can only respond to user interactions and slash commands. It couldn't send a message without first being prompted. 

More importantly, I saw a tension here with my bot needing to listen for user commands and also being serverless. My thinking was that if my bot was serverless, then in what sense could it be listening for user commands? As 'listening' implies that my bot is in some sense running regardless of whether there are incoming requests but a serverless application is one where code is only executed when an incoming request is received. 

Eventually, I decided to focus on the question of whether a discord bot can send a message to a guild channel by its own volition. This was the nub of what I was trying to achieve as now Cloudflare was handling the scheduling side of things. I did some reading through the official Discord API and found exactly what I needed [here](https://discord.com/developers/docs/resources/channel#create-message). Then I tried to see if I could make a simple HTTP request to send a message as the discord bot and this worked wonderfully. I proceeded to implement the Cloudflare Worker so that a cron trigger, would instruct my discord bot to send a message to my desired channel. Then I wrote some tests before deploying this to Cloudflare. Now every Friday at 5pm, my discord bot would send a reminder in the way I desire.

What I learnt from this experience was that I should have started with the actual Discord API documentation before attempting to use the discord.js api wrapper. It seems that the benefits that the abstractions that API wrappers provide can be only realised if you have a good understanding of the API itself as they are really there to make the development experience easier but that's only true if you already have experience working with APIs and understand the pain points and problems that API wrappers solve. 

It seems that discord.js is targeted towards users who are making discord bots designed to be run on servers and so the concepts that they use might not apply to serverless applications. I would also like to gain a better understanding of APIs and API design. 

For now I am content that my discord bot is working and plan to learn more about the Discord API itself to see how it has been designed and documented. An interesting thing I have noticed from the API is that channels and guilds are treated as independent entities despite how channels cannot exist without belonging to some guild.
